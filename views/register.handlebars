<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Register For A Process</title>
    <style>
        form {
            width: 50%;
            margin: 50px auto;
            max-width: 800px;
        }

        @media only screen and (max-width: 800px){
            form{
                width: 80%;
            }
        }

        #notifier.error {
            color: #a40606;
        }

        #notifier.success {
            color: #326f00;
        }

        .contactable-type {
            display: none;
        }

        .show {
            display: block;
        }
    </style>

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/milligram/1.3.0/milligram.css">
</head>

<body>
    <form action="{{formHandler}}" method="post">
        <div id="notifier"></div>
        {{!-- Registration has opened and not closed --}}
        {{#registrationHasOpened}}
          {{^registrationClosed}}
          <div id="process-context">
              <h1>You are invited to join a rapid sensemaking process</h1>
              {{#showParticipantBlock}}
              <p>Registration is limited to {{maxParticipants}} participants.
                  <br />{{participantCount}} have registered so far.</p>
              {{/showParticipantBlock}}
              {{#showTime}}
              <p>Registration will remain open for another <span id="remaining_time">{{remainingTime}}</span> seconds.</p>
              {{/showTime}}
              <h4>Description</h4>
              <p>{{description}}</p>
          </div>
          {{> contactable_form }}
          <button class="button" type="submit">Register</button>
          {{/registrationClosed}}
        {{/registrationHasOpened}}
        {{^registrationHasOpened}}
        <div id="process-context">
            Registration for this process has not yet begun.
        </div>
        {{/registrationHasOpened}}
        {{#registrationClosed}}
        <div id="process-context">
            Registration for this process has closed.
        </div>
        {{/registrationClosed}}
    </form>


    <script>

        // do countdown
        const remainingDiv = document.getElementById('remaining_time')
        if (remainingDiv) {
            let timeRemaining = parseInt(remainingDiv.innerText)
            window.setInterval(() => {
                timeRemaining--
                if (timeRemaining === 0) {
                    remainingDiv.parentNode.innerText = 'Registration has closed.'
                    window.clearInterval(interval)
                } else {
                    remainingDiv.innerText = timeRemaining
                }
            }, 1000) // every 1 second
        }

        function checkForSuccess(field) {
            const url = window.location.href;
            if (url.indexOf('?' + field) != -1)
                return true;
            else if (url.indexOf('&' + field) != -1)
                return true;
            return false
        }

        // display feedback messages, according
        // to url query params
        if (checkForSuccess('success')) {
            document.getElementById('notifier').classList.add('success')
            document.getElementById('notifier').innerText = 'You were successfully registered'
        } else if (checkForSuccess('failure')) {
            document.getElementById('notifier').classList.add('error')
            document.getElementById('notifier').innerText = 'The input is invalid'
        }

        // from contactable_form.mustache
        clearAndSetupContactableFormListeners()
    </script>
</body>

</html>